# 🎀 きせかえゲーム (Dress-Up Game)

子供向け2D着せ替えWebゲーム

## 📌 現在のバージョン: v0.9.3

## ✨ 特徴

- 🎨 かわいいドールに服を着せ替え
- 👆 ドラッグ&ドロップで簡単操作
- 📱 iPad/タブレット対応（タッチ操作・ピンチズーム）
- 🔄 リセットボタンで全部脱がせる
- 🖼️ 背景切り替え機能
- 📐 ドール・アイテム位置調整機能
- 📦 ZIPプリセットインポート対応
- 📸 スクリーンショット保存機能
- 🎨 らくがき・消しゴム機能

---

## 🎮 遊び方

1. **設定（⚙️）** からプリセットZIPをインポート
2. **ドール選択** でドールを選ぶ
3. **カテゴリ** をタップしてアイテム一覧を表示
4. **アイテム** をドラッグしてドールエリアにドロップ
5. **🔧ボタン** でアイテムの位置・サイズ・傾きを調整
6. **🖼️はいけい** ボタンで背景を変更
7. **📸ボタン** でスクリーンショット保存

---

## 🎯 実装済み機能

### ドール表示・操作
- PixiJS 8による高品質レンダリング
- ドラッグで位置調整（-50%〜150%の広範囲移動可能）
- ピンチズームでサイズ調整（0.3〜2.0倍）
- 縮小時の画質改善（リニア補間）
- 背景は画面全体の最背面に表示

### 着せ替え機能
- カテゴリ別アイテム選択（2列グリッド、サムネイル表示）
- ドラッグ&ドロップでアイテム装着
- ドラッグ中のプレビュー表示（タッチ位置にサムネイル）
- movableアイテムの自由配置（ドロップ位置に表示）
- 「なし」選択で脱がせる（誤操作防止のため画面下部に配置）
- レイヤー順制御（フォルダ名の番号で重ね順を決定）

### アイテム調整機能（🔧ボタン）
- **位置調整**: タッチドラッグ / マウスドラッグ
- **サイズ調整**: ピンチイン・アウト / マウスホイール
- **傾き調整**: 二本指回転 / Shift+マウスホイール
- ✓完了 / ↺リセット ボタン

### プリセット管理
- ZIPファイルからドール・背景・服を一括インポート
- IndexedDB + LocalStorageでデータ永続化
- サムネイル画像対応（`_thumb`サフィックス）

### UI/UX
- 160px幅の縦長メニュー（2列グリッド、サムネイル表示）
- 設定パネル（⚙️ボタン）
- 背景選択をカテゴリリスト上部に配置
- 大きな戻るボタンとなしボタン（誤操作防止）

### その他
- 📸 スクリーンショット保存（PNG形式）
- 🎨 らくがきモード（自由に絵を描ける）
- 🧹 消しゴムモード（ドールの一部を消せる）
- 状態の自動保存・復元（ブラウザを閉じても維持）

---

## 📦 プリセット作成ガイド

### フォルダ構成

```
プリセット.zip/
├── backgrounds/              # 背景画像（全ドール共通）
│   ├── 背景1.png
│   ├── 背景1_thumb.png      # サムネイル（オプション）
│   └── ...
│
└── doll-{ドールID}/          # ドール別フォルダ
    ├── dolls/                # ドール画像
    │   └── {ドール名}.png
    │
    └── clothing/             # 服画像（このドール専用）
        ├── {レイヤー順}_{並び順}_{カテゴリ名}/
        │   ├── アイテム1.png
        │   ├── アイテム1_thumb.png  # サムネイル（オプション）
        │   └── ...
        └── ...
```

### フォルダ命名規則

#### カテゴリフォルダ名

```
{レイヤー順}_{カテゴリ並び順}_{カテゴリ名}
```

| 要素 | 説明 | 例 |
|------|------|-----|
| レイヤー順 | 重ね順（小さい=下、大きい=上） | 01, 02, 10 |
| カテゴリ並び順 | メニュー表示順（小さい=上） | 1, 2, 10 |
| カテゴリ名 | 表示されるカテゴリ名 | トップス, くつ |

**例:**
```
clothing/
├── 01_3_ソックス/      # レイヤー1（最下）、メニュー3番目
├── 02_4_インナー/      # レイヤー2、メニュー4番目
├── 02_7_くつ/          # レイヤー2、メニュー7番目
├── 03_6_ボトムス/      # レイヤー3、メニュー6番目
├── 04_5_トップス/      # レイヤー4、メニュー5番目
├── 04_1.5_ドレス/      # レイヤー4、メニュー1.5番目
├── 10_1_かお/          # レイヤー10、メニュー1番目
└── 11_10_アクセサリー/ # レイヤー11（最上）、メニュー10番目
```

#### 特殊フラグ

| フラグ | 説明 | 例 |
|--------|------|-----|
| `_movable` | 自由配置可能にする | `10_1_かお_movable/` |

### 定義済みカテゴリ

| フォルダ名 | 表示名 | emoji | 自由配置 |
|-----------|--------|-------|---------|
| top | トップス | 👚 | - |
| bottom | ボトムス | 👖 | - |
| dress | ワンピース | 👗 | - |
| shoes | くつ | 👟 | - |
| accessory | アクセサリー | 🎀 | ✓ |
| hat | ぼうし | 🎩 | - |
| socks | くつした | 🧦 | - |
| bag | かばん | 👜 | ✓ |
| face | 顔パーツ | 😊 | ✓ |
| underwear_top | したぎ(うえ) | 🩱 | - |
| underwear_bottom | したぎ(した) | 🩲 | - |

**※ 上記以外のフォルダ名も使用可能**（emoji は 📁 になります）

---

## 🖼️ 画像仕様・推奨サイズ

### 画像サイズ一覧

| 種類 | 推奨サイズ | アスペクト比 | 形式 |
|------|-----------|-------------|------|
| ドール | **512×1024px** | 1:2（縦長） | PNG（透過） |
| 服アイテム | **512×1024px** | ドールと同じ | PNG（透過） |
| 背景 | **1920×1080px** | 16:9（横長） | PNG/JPEG |
| サムネイル | **64×64px** | 1:1（正方形） | PNG |

### 詳細仕様

#### ドール画像
```
サイズ: 512×1024ピクセル（縦長）
形式: PNG（透過背景必須）
配置: 画像の中央にキャラクターを配置
注意: 全身が収まるように余白を確保
```

**推奨設定:**
- キャラクターは画像の中央に配置
- 上下左右に適度な余白（10%程度）
- 解像度: 72〜150dpi

#### 服アイテム画像
```
サイズ: 512×1024ピクセル（ドールと同じ）
形式: PNG（透過背景必須）
配置: ドールと同じ位置に服を配置
重要: ドールに重ねた時にぴったり合うように作成
```

**重要ポイント:**
- ドール画像と**完全に同じサイズ・同じ位置**で作成
- 服だけを描画（体は描かない）
- 透過PNGで出力
- 下の服が透けないよう塗りつぶす

#### 背景画像
```
サイズ: 1920×1080ピクセル（横長）
形式: PNG または JPEG（80%品質）
配置: キャンバス全体を覆う
```

**容量削減:**
- JPEGで保存すると大幅に容量削減
- 品質80%でも視覚的な差は小さい

#### サムネイル画像
```
サイズ: 64×64ピクセル（正方形）
形式: PNG（透過推奨）
ファイル名: 元画像名_thumb.png
```

**例:**
- 元画像: `dress01.png`
- サムネイル: `dress01_thumb.png`

### 画像フォーマット詳細

| 形式 | 用途 | 透過 | 備考 |
|------|------|------|------|
| PNG | ドール、服、サムネ | ✓ | 推奨 |
| JPEG | 背景のみ | ✗ | 容量小 |
| WebP | 全て | ✓ | 対応ブラウザのみ |
| GIF | 全て | △ | 256色制限 |

---

## 🎨 AI画像生成のコツ

### ドール生成プロンプト例

```
【ちびキャラ】
XXXXスタイルのかわいいちびキャラ、全身、正面立ち絵、
2頭身～3頭身のデフォルメ、シンプルなアニメ調、
明るい肌色、両腕を少し広げたポーズ、両足揃え、
真っ白な背景、画像中央に配置、
透過PNG対応、512×1024ピクセル

【リアル等身】
XXXXスタイルの女の子キャラ、全身、正面立ち絵、
6頭身～7頭身、アニメ調イラスト、
自然な立ちポーズ、まっすぐ立つ、
真っ白な背景、画像中央に配置、
透過PNG対応、512×1024ピクセル
```

### 服生成プロンプト例

```
【トップス】
服のみ、人物なし、宙に浮いた状態、
XXXXデザインのかわいいトップス、
正面から見た状態、平らに広げた形、
アニメ調イラスト、
透過PNG、背景なし、
ドールと同じサイズ・ポーズに合わせる

【ボトムス】
服のみ、人物なし、宙に浮いた状態、
XXXXデザインのかわいいボトムス、
正面から見た状態、
アニメ調イラスト、
透過PNG、背景なし、
ドールと同じサイズに合わせる
```

### 背景生成プロンプト例

```
背景イラスト、キャラクターなし、
XXXXをテーマにした場所、
アニメ調、カラフル、詳細に描く、
横長、16:9の比率、1920×1080ピクセル
```

### 推奨AIサービス

| サービス | 特徴 | 料金 |
|----------|------|------|
| Stable Diffusion | ローカル実行可 | 無料 |
| NovelAI | アニメ向け | 有料 |
| Midjourney (--niji) | 高品質 | 有料 |
| にじジャーニー | アニメ特化 | 有料 |

### 背景透過ツール

- **remove.bg** - Web無料ツール
- **Photoshop** - 「被写体を選択」機能
- **GIMP** - 無料ソフト

---

## 🛠️ 技術スタック

| カテゴリ | 技術 |
|----------|------|
| Build Tool | Vite 7.x |
| Framework | React 19 + TypeScript (strict) |
| Graphics | PixiJS 8 |
| Storage | IndexedDB + LocalStorage |
| Archive | JSZip |
| Testing | Vitest + Playwright |

---

## 📁 プロジェクト構成

```
src/
├── App.tsx              # メインアプリ（状態管理の中心）
├── App.css              # グローバルスタイル
├── components/          # Reactコンポーネント
│   ├── AvatarCanvas.tsx     # PixiJSキャンバス表示
│   ├── DressUpMenu.tsx      # カテゴリ・アイテム選択UI
│   ├── ItemAdjustPanel.tsx  # アイテム位置調整パネル
│   ├── DrawingCanvas.tsx    # らくがきキャンバス
│   ├── EraserCanvas.tsx     # 消しゴムキャンバス
│   ├── SettingsPanel.tsx    # 設定パネル
│   └── ItemImporter.tsx     # ZIPインポートUI
├── engine/
│   └── PixiEngine.ts        # PixiJS描画エンジン
├── hooks/
│   └── useDressUp.ts        # 着せ替え状態管理フック
├── services/
│   ├── assetStorage.ts      # IndexedDB/LocalStorage管理
│   └── stateStorage.ts      # 状態の保存・復元
├── types/
│   └── index.ts             # 型定義・カテゴリマッピング
└── tests/                   # ユニットテスト
```

---

## 🚀 セットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバー起動
npm run dev

# ブラウザで開く
# http://localhost:5173/DressUpGame/
```

## 📋 コマンド

| コマンド | 説明 |
|---------|------|
| `npm run dev` | 開発サーバー起動 |
| `npm run build` | 本番ビルド |
| `npm run preview` | ビルドプレビュー |
| `npm run test` | ユニットテスト |
| `npm run test:e2e` | E2Eテスト |
| `npm run lint` | ESLintチェック |
| `npm run deploy` | GitHub Pagesデプロイ |

---

## 💡 FAQ

### Q: 縮小すると画質が荒れます

A: **元画像を小さめに作成して拡大表示**がおすすめです。

- 縮小時：情報が失われ、エイリアシング発生
- 拡大時：補間処理でスムーズに拡大可能

推奨：元画像を512×1024pxで作成し、scale 1.0〜2.0で表示

### Q: 服がドールとずれます

A: **ドールと服を完全に同じサイズ・配置**で作成してください。

1. ドール画像を下絵として読み込む
2. その上に服を描画
3. 同じキャンバスサイズで出力

### Q: 容量を削減したい

A: 以下の方法で削減可能：
- 背景はJPEG（品質80%）で保存
- サムネイルを64×64pxで用意
- 不要な余白をトリミング

### Q: 自由に配置できるアイテムを作りたい

A: フォルダ名に `_movable` を付けるか、以下のカテゴリを使用：
- `accessory`
- `bag`
- `face`

---

## 🔧 開発者向け情報

### 重要な型定義

```typescript
// 服アイテム
interface ClothingItemData {
  id: string;
  name: string;
  type: ClothingType;
  imageUrl: string;
  thumbnailUrl?: string;
  position: Position;
  baseZIndex: number;
  movable?: boolean;
  layerOrder?: number;
  categoryOrder?: number;
  dollId?: string;
}

// ドール変形
interface DollTransform {
  x: number;  // 0-100% (中央=50)
  y: number;  // 0-100%
  scale: number; // 0.3-2.0
}

// 装備アイテム調整値
interface EquippedItem extends ClothingItemData {
  equipOrder: number;
  adjustOffsetX?: number;  // 位置調整X
  adjustOffsetY?: number;  // 位置調整Y
  adjustScale?: number;    // サイズ調整
  adjustRotation?: number; // 傾き調整
}
```

### PixiJS描画フロー

1. `AvatarCanvas` マウント時に `PixiEngine.init()`
2. `dollTransform` 変更で `drawDoll()` + `drawClothing()` 再描画
3. `equippedItems` 変更で `drawClothing()` 再描画
4. アンマウント時に `destroy()` でリソース解放

---

## 📝 更新履歴

- **v0.9.3** - ドール回転機能削除、スクリーンショット修正
- **v0.9.2** - ドール回転追加、調整UI簡略化、初期位置修正
- **v0.9.1** - ItemAdjustPanel統合（ドール＋アイテム調整）
- **v0.9.0** - アイテム調整機能追加
- **v0.6.0** - movableアイテム、レイヤー順制御

---

## 📝 ライセンス

MIT License
